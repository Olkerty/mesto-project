(()=>{"use strict";var e={d:(t,o)=>{for(var n in o)e.o(o,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:o[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};function t(e,t,o){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(o),t.disabled=!1):(t.classList.add(o),t.disabled=!0)}e.d({},{vc:()=>$,f:()=>E,Cx:()=>R});const o=document.querySelector(".profile__title"),n=document.querySelector(".profile__subtitle");let r="571dcf6f2cfcc0fecc4eba60";function c(e,t,o){return fetch(`https://nomoreparties.co/v1/plus-cohort-1/cards/likes/${o}`,{method:e,headers:t}).catch((e=>{console.log(e)}))}const a=document.querySelector('div[name="popupform__picture"]'),i=document.querySelector('input[name="popupadd__image-name"]'),s=document.querySelector('input[name = "popupadd__link"]'),u=document.querySelector(".profile__title"),d=document.querySelector('input[name="popup__avatar-redact-link"]'),l=document.querySelector(".profile__subtitle"),p=document.querySelector("input[name='profile__name']"),m=document.querySelector('input[name = "profile__profession"]'),f=document.querySelector('form[name="popupadd__form-itself"]');function _(e,t){const o=t.querySelector(".popupform__save-button");o.textContent="",o.textContent=e}function v(e){"Escape"==e.key&&h(document.querySelector(".popupform_opened"))}function y(e){e.classList.add("popupform_opened"),document.addEventListener("keydown",v)}function h(e){e.classList.remove("popupform_opened"),document.removeEventListener("keydown",v)}const S=document.querySelector("#template"),L=document.querySelector(".photo-grid"),k=document.querySelector('div[name="popupform__affirm"]');function q(e,t,o){!function(e,t,o){fetch(`https://nomoreparties.co/v1/plus-cohort-1/cards/${o}`,{method:"DELETE",headers:t})}(0,$.contentHeaders,e),o.removeEventListener("click",(()=>q(e,eventTarget,o))),t.closest(".photo-grid__item").remove(),h(k)}function g(e,t,o){L.append(function(e,t,o){const n=S.content.cloneNode(!0),r=n.querySelector(".photo-grid__picture");r.src=e.link,r.alt=e.name,r.addEventListener("click",(()=>function(e,t){y(e);let o=a.querySelector('img[name="popupform__image"]');o.src=t.link,o.alt=t.name,o=a.querySelector('p[name="popupform__text"]'),o.textContent=t.name}(a,e))),n.querySelector(".photo-grid__text").textContent=e.name;const i=n.querySelector(".photo-grid__like");if(i.addEventListener("click",(()=>function(e,t){e.classList.toggle("photo-grid__like_liked");const o=e.parentElement.querySelector(".photo-grid__like-count");Array.from(e.classList).includes("photo-grid__like_liked")?(c("PUT",$.contentHeaders,t),o.textContent=+o.textContent+1):(c("DELETE",$.contentHeaders,t),o.textContent=+o.textContent-1)}(event.target,e._id))),t&&i.classList.add("photo-grid__like_liked"),n.querySelector(".photo-grid__like-count").textContent=e.likes.length,o){const t=n.querySelector(".photo-grid__delete");t.style.display="block",t.addEventListener("click",(()=>function(e,t){y(k);const o=k.querySelector(".popupform__save-button");o.addEventListener("click",(()=>q(e,t,o)))}(e._id,event.target)))}return n}(e,t,o))}const E=document.querySelector(".profile__avatar"),b=document.querySelector(".profile__hover-mask"),C=document.querySelector(".profile__edit-button"),x=document.querySelector(".profile__add-button"),H=document.querySelector(".popupform"),j=document.querySelector('div[name = "popupadd"]'),A=document.querySelector('div[name = "popupform__avatar-redact"]'),P=document.querySelector('button[name = "popupadd__close-icon"]'),T=document.querySelector(".popupform__close-icon"),U=document.querySelector(".popupform__form-itself"),R=document.querySelector('form[name= "popup__avatar-redact-form-itself"]'),$={URLme:"https://nomoreparties.co/v1/plus-cohort-1/users/me",URLmyAvatar:"https://nomoreparties.co/v1/plus-cohort-1/users/me/avatar",URLcards:"https://nomoreparties.co/v1/plus-cohort-1/cards",contentHeaders:{authorization:"18ac5fe7-c9dd-44de-b0c4-3e05d66a3a3c","Content-Type":"application/json"},tokenHeaders:{authorization:"18ac5fe7-c9dd-44de-b0c4-3e05d66a3a3c"}},B=document.querySelector(".popupform__img-close-icon"),O={submitButtonSelector:"popupform__save-button",inactiveButtonClass:"popupform__save-button_inactive",inputErrorClass:"popupform__input-type_error",errorClass:"popupform__input-error_active"};var D,N,w;Array.from(document.querySelectorAll(".popupform__container")).forEach((function(e){document.addEventListener("mouseup",(function(t){t.target==e||e.contains(t.target)||h(e.closest(".popupform"))}))})),E.addEventListener("mouseover",(function(e){document.querySelector(".profile__hover-mask").classList.add("profile__hover-mask_visible")})),b.addEventListener("mouseout",(function(e){document.querySelector(".profile__hover-mask").classList.remove("profile__hover-mask_visible")})),U.addEventListener("submit",(()=>function(e,t){var o,n,r,c;e.preventDefault(),_("Сохранение...",t),u.textContent=p.value,l.textContent=m.value,o=$.URLme,n=$.contentHeaders,r=p.value,c=m.value,fetch(o,{method:"PATCH",headers:n,body:JSON.stringify({name:r,about:c})}).catch((e=>{console.log(e)})),h(t),_("Сохранить",t)}(event,H))),T.addEventListener("click",(()=>h(H))),P.addEventListener("click",(()=>h(j))),b.addEventListener("click",(()=>y(A))),R.addEventListener("submit",(()=>function(e,t){var o,n,r;e.preventDefault(),_("Сохранение...",t),o=$.URLmyAvatar,n=$.contentHeaders,r=d.value,fetch(o,{method:"PATCH",headers:n,body:JSON.stringify({avatar:r})}).catch((e=>{console.log(e)})),E.src=d.value,R.reset(),h(t),_("Сохранить",t),h(t)}(event,A))),D=$.URLme,N=$.tokenHeaders,fetch(D,{headers:N}).then((e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`))).then((e=>{o.textContent=e.name,n.textContent=e.about,E.src=e.avatar})).catch((e=>{console.log(e)})),function(e,t){fetch(e,{headers:t}).then((e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`))).then((e=>{let t=!1,o=!1;for(let n=e.length-1;n>=0;n--)t=!1,o=!1,e[n].likes.forEach((function(e){e._id==r&&(t=!0)})),e[n].owner._id==r&&(o=!0),g(e[n],t,o)})).catch((e=>{console.log(e)}))}($.URLcards,$.tokenHeaders),B.addEventListener("click",(()=>h(a))),w=O,Array.from(document.forms).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,o){const n=Array.from(e.getElementsByTagName("input")),r=e.querySelector(`.${o.submitButtonSelector}`);t(n,r,o.inactiveButtonClass),n.forEach((function(c){c.addEventListener("input",(function(){!function(e,t,o,n){t.validity.valid?function(e,t,o,n){const r=e.querySelector(`.${t.id}-error`);t.classList.remove(o),r.textContent="",r.classList.remove(n)}(e,t,o,n):function(e,t,o,n,r){const c=e.querySelector(`.${t.id}-error`);t.classList.add(n),c.textContent=o,c.classList.add(r)}(e,t,t.validationMessage,o,n)}(e,c,o.inputErrorClass,o.errorClass),t(n,r,o.inactiveButtonClass)}))}))}(e,w)})),C.addEventListener("click",(()=>{return e=H,p.value=u.textContent,m.value=l.textContent,void y(e);var e}),!1),x.addEventListener("click",(()=>y(j))),P.addEventListener("click",(()=>h(j))),f.addEventListener("submit",(()=>function(e,t,o){var n,r,c,a;e.preventDefault(),_("Создание...",t),n=$.URLcards,r=$.contentHeaders,c=i.value,a=s.value,fetch(n,{method:"POST",headers:r,body:JSON.stringify({name:c,link:a})}).then((e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`))).then((e=>{console.log(e),g(e,!1,!0)})).catch((e=>{console.log(e)})),f.reset();const u=t.querySelector(".popupform__save-button");u.classList.add(o),u.disabled=!0,h(t),_("Создать",t)}(event,j,O.inactiveButtonClass)))})();